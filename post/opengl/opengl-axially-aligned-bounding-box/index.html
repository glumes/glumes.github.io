<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">


  <title>《OpenGL ES 3.x 游戏开发》碰撞检测之 AABB 包围盒</title>
  <meta property="og:title" content="《OpenGL ES 3.x 游戏开发》碰撞检测之 AABB 包围盒" />
  <meta name="twitter:title" content="《OpenGL ES 3.x 游戏开发》碰撞检测之 AABB 包围盒" />

  <meta name="description" content="学习笔记内容摘录">
  <meta property="og:description" content="学习笔记内容摘录">
  <meta name="twitter:description" content="学习笔记内容摘录">
  <meta name="author" content=""/>
  <meta name="referrer" content="origin" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://glumes.com/post/opengl/opengl-axially-aligned-bounding-box/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="星陨的博客" />

  <meta name="generator" content="Hugo 0.74.3" />
  <link rel="canonical" href="https://glumes.com/post/opengl/opengl-axially-aligned-bounding-box/" />
  <link rel="alternate" href="https://glumes.com/index.xml" type="application/rss+xml" title="星陨的博客">
  <link rel="stylesheet" href="https://glumes.com/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://glumes.com/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://glumes.com/css/main.css?t=126" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://glumes.com/css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://glumes.com/css/highlight.min.css" />
  <link rel="stylesheet" href="https://glumes.com/css/prism.css?t=123" />
  <link rel="stylesheet" href="https://glumes.com/css/search.css" />
  

<link rel="stylesheet" href="https://res.cloudinary.com/glumes-com/raw/upload/v1516330613/website/css/prism.css" />






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-84590324-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?9276c0ce2d3c49b591323abab4a32e1e";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
</script>



</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://glumes.com/">星陨的博客</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">音视频开发</a>
              <div class="navlinks-children">
                
                  <a href="https://glumes.com/categories/opengl">OpenGL </a>
                
                  <a href="https://glumes.com/categories/ffmpeg">FFmpeg</a>
                
                  <a href="https://glumes.com/categories/vulkan">Vulkan </a>
                
                  <a href="https://glumes.com/categories/webrtc">WebRTC </a>
                
                  <a href="https://glumes.com/categories/opencv">opencv </a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">移动开发</a>
              <div class="navlinks-children">
                
                  <a href="https://glumes.com/categories/android">Android</a>
                
                  <a href="https://glumes.com/categories/ios">ios</a>
                
                  <a href="https://glumes.com/categories/c&#43;&#43;">C&#43;&#43;</a>
                
                  <a href="https://glumes.com/categories/python">Python</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="程序人生" href="https://glumes.com/categories/life">程序人生</a>
            </li>
          
        
          
            <li>
              <a title="标签" href="https://glumes.com/tags">标签</a>
            </li>
          
        
          
            <li>
              <a title="关于" href="https://glumes.com/about/">关于</a>
            </li>
          
        
          
            <li>
              <a title="文章集" href="https://glumes.com/post/">文章集</a>
            </li>
          
        

        

        

        

      </ul>
    </div>

  </div>
</nav>





    
  
  
  




  
    <div id="header-big-imgs" data-num-img=1 data-img-src-1="https://image.glumes.com/images/2019/04/27/bc32fd77gy1ftn636nobej20zk0me7a8.jpg" ></div>
  

  <header class="header-section has-img">
    
      <div class="intro-header big-img">
        
        
        <div class="container">
          <div class="row">
              <div class="col-lg-12 col-md-12 col-md-offset-0">
                
                <div class="page-heading">
                
                  
                     <h1>《OpenGL ES 3.x 游戏开发》碰撞检测之 AABB 包围盒</h1>
                     
                     
                  
                  
                  
                    
                      <h2 align="center" class="post-subheading">学习笔记内容摘录</h2>
                    
                  
                  
                    <span class="post-meta">
  Posted on July 26, 2018
  
</span>


                  
                
              </div>
            </div>
          </div>
        </div>
        <span class="img-desc" style="display: inline;"></span>
      </div>
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-md-offset-0">
            <div class="post-heading">
                <h1 align="center">《OpenGL ES 3.x 游戏开发》碰撞检测之 AABB 包围盒</h1>
                
                  
                    <h2 align="center" class="post-subheading">学习笔记内容摘录</h2>
                  
                
                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">



        
      <div>
          
          
          <h5 id="tags" style="margin-top: 0px;">标签:
            
                <a href="https://glumes.com/tags/opengl/">OpenGL</a> &nbsp;
            
          </h5>
          
      </div>

      <article role="main" class="blog-post" itemprop="articleBody" id="content">
        
          
<aside class="toc">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#碰撞检测实现原理">碰撞检测实现原理</a></li>
    <li><a href="#aabb-包围盒计算">AABB 包围盒计算</a></li>
    <li><a href="#aabb-包围盒的碰撞检测">AABB 包围盒的碰撞检测</a></li>
    <li><a href="#实践">实践</a></li>
    <li><a href="#注意点">注意点</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
</aside>

        

            <h3>当当开学季囤书活动</h3>

<p>又是开学季，当当百万自营图书大幅度优惠。</p>

<p>每满100减50，满200减100，满300减150，满400减200。</p>

<p>使用我的优惠码 【4TSDNP】（注意区分大小写），可与满减叠加使用，花 160 即可买价值 400 的图书！！</p>


<p>音视频方面的好书赶紧囤起来吧，<a href="https://mp.weixin.qq.com/s/YRC0XtcvVRV55D6FeepwTg">使用详情 和 好书推荐 点击这里</a> </p>


<HR align=center width=300 color=#987cb9 SIZE=1>

        <p>在 OpenGL 的世界模型中，同时绘制了多个物体，那么怎么去检测物体之间是否触碰了，不同于在平面之间的触碰，OpenGL 是在三维世界里面的触碰，接下来就继续深入理解 OpenGL 中的碰撞检测相关知识~~~</p>
<h2 id="碰撞检测实现原理">碰撞检测实现原理</h2>
<p>进行碰撞检测时最直观和最精确的方式就是采用组成物体的三角形来进行，将待检测的两个物体的三角形组中的三角形两两进行相交性检测，若有任意一对三角形相交则物体构成碰撞，否则物体不构成碰撞。</p>
<p>这样的思路很直观，但是计算量大，在一般设备上是难以实施的。</p>
<p>通过一种简化的思路来间接实现碰撞检测，采用 <code>AABB （Axially Aligned Bounding Box）</code>包围盒的方式实现。</p>
<p>AABB 包围盒就是采用一个长方体将物体包裹起来，进行两个物体的相交性检测时仅检测物体对应包围盒（包裹物体的长方体）的相交性。</p>
<p>另外，AABB 包围盒有一个重要特性，那就是包围盒对应的长方体每一个面都是与某个坐标轴平面平行的，因此，AABB 包围盒又称了 <code>轴对齐包围盒</code> 。</p>
<p>对于不同物体包围盒直接示例，如下图：</p>
<p><img src="https://image.glumes.com/images/2019/04/27/bc32fd77gy1ftn0tnab4pj209p03yweu.jpg" alt="不同物体的 AABB 包围盒"></p>
<p>有了上述约定后，确定 AABB 包围盒就简单多了，仅需要记录 6 个值即可，这 6 个值分别代表包围盒在每个坐标轴上的最小值与最大值，即 $x_{min}$、$x_{max}$、$y_{min}$、$y_{max}$、$z_{min}$、$z_{max}$。</p>
<p>也就是说，实际物体上所有的点都必须满足以下条件：</p>
<p>$$ x_{min}  \le x  \le x_{max} $$
$$ y_{min}  \le y  \le y_{max} $$
$$ z_{min}  \le z  \le z_{max} $$</p>
<p>另外，可以将表示 AABB 包围盒的 6 个参数分为以下两组：</p>
<p>$$P_{min} = [x_{min} , y_{min} , z_{min}]$$
$$P_{max} = [x_{max} , y_{max} , z_{max}]$$</p>
<p>其中，$P_{min}$ 是 3 个轴坐标最小值的集合，$P_{max} $ 是 3 个轴坐标最大值的集合。</p>
<p>知道了表示 AABB 包围盒的 6 个参数后就可以非常方便地求得 AABB 包围盒的几何中心，公式如下：</p>
<p>$$c=(P_{min} + P_{max})  /  2$$</p>
<h2 id="aabb-包围盒计算">AABB 包围盒计算</h2>
<p>了解了 AABB 包围盒的原理之后，求 AABB 包围盒 6 个参数的方法就简单多了，只需要对物体中的所有顶点坐标进行扫描，求出各个轴分量的最大值与最小值即可。</p>
<p>首先引入一个辅助类 <code>Vector3f</code>，其对象可以记录 3 个浮点数组成的三元组，用来表示物体的位置、速度等。</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#859900">public</span> <span style="color:#859900">class</span> <span style="color:#cb4b16">Vector3f</span> {
    <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">x</span>;<span style="color:#93a1a1;font-style:italic">//三维变量中的x值
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">y</span>;<span style="color:#93a1a1;font-style:italic">//三维变量中的y值
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">z</span>;<span style="color:#93a1a1;font-style:italic">//三维变量中的z值
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900">public</span> <span style="color:#268bd2">Vector3f</span>(<span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">x</span>,<span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">y</span>,<span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">z</span>)
    {
        <span style="color:#859900">this</span>.<span style="color:#268bd2">x</span>=<span style="color:#268bd2">x</span>;
        <span style="color:#859900">this</span>.<span style="color:#268bd2">y</span>=<span style="color:#268bd2">y</span>;
        <span style="color:#859900">this</span>.<span style="color:#268bd2">z</span>=<span style="color:#268bd2">z</span>;
    }
    <span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">void</span> <span style="color:#268bd2">add</span>(<span style="color:#268bd2">Vector3f</span> <span style="color:#268bd2">temp</span>)
    {
        <span style="color:#859900">this</span>.<span style="color:#268bd2">x</span>+=<span style="color:#268bd2">temp</span>.<span style="color:#268bd2">x</span>;
        <span style="color:#859900">this</span>.<span style="color:#268bd2">y</span>+=<span style="color:#268bd2">temp</span>.<span style="color:#268bd2">y</span>;
        <span style="color:#859900">this</span>.<span style="color:#268bd2">z</span>+=<span style="color:#268bd2">temp</span>.<span style="color:#268bd2">z</span>;
    }
}
</code></pre></div><p>有了此辅助类之后，物体的位置、速度等就可以直接用此类的对象表示了。</p>
<p>接下来就是计算物体的 AABB 包围盒，定义一个对象 AABBBox 来表示包围盒。</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#859900">public</span> <span style="color:#859900">class</span> <span style="color:#cb4b16">AABBBox</span> {
    <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">minX</span>;<span style="color:#93a1a1;font-style:italic">//x轴最小位置
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">maxX</span>;<span style="color:#93a1a1;font-style:italic">//x轴最大位置
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">minY</span>;<span style="color:#93a1a1;font-style:italic">//y轴最小位置
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">maxY</span>;<span style="color:#93a1a1;font-style:italic">//y轴最大位置
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">minZ</span>;<span style="color:#93a1a1;font-style:italic">//z轴最小位置
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">maxZ</span>;<span style="color:#93a1a1;font-style:italic">//z轴最大位置
</span><span style="color:#93a1a1;font-style:italic"></span>
    <span style="color:#859900">public</span> <span style="color:#268bd2">AABBBox</span>(<span style="color:#859900;font-weight:bold">float</span>[] <span style="color:#268bd2">vertices</span>)
    {
        <span style="color:#268bd2">init</span>();
        <span style="color:#268bd2">findMinAndMax</span>(<span style="color:#268bd2">vertices</span>);
    }

    <span style="color:#859900">public</span> <span style="color:#268bd2">AABBBox</span>(<span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">minX</span>,<span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">maxX</span>,<span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">minY</span>,<span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">maxY</span>,<span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">minZ</span>,<span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">maxZ</span>)
    {
        <span style="color:#859900">this</span>.<span style="color:#268bd2">minX</span>=<span style="color:#268bd2">minX</span>;
        <span style="color:#859900">this</span>.<span style="color:#268bd2">maxX</span>=<span style="color:#268bd2">maxX</span>;
        <span style="color:#859900">this</span>.<span style="color:#268bd2">minY</span>=<span style="color:#268bd2">minY</span>;
        <span style="color:#859900">this</span>.<span style="color:#268bd2">maxY</span>=<span style="color:#268bd2">maxY</span>;
        <span style="color:#859900">this</span>.<span style="color:#268bd2">minZ</span>=<span style="color:#268bd2">minZ</span>;
        <span style="color:#859900">this</span>.<span style="color:#268bd2">maxZ</span>=<span style="color:#268bd2">maxZ</span>;
    }
    <span style="color:#93a1a1;font-style:italic">//初始化包围盒的最小以及最大顶点坐标
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">void</span> <span style="color:#268bd2">init</span>()
    {
        <span style="color:#268bd2">minX</span>=<span style="color:#268bd2">Float</span>.<span style="color:#268bd2">POSITIVE_INFINITY</span>;
        <span style="color:#268bd2">maxX</span>=<span style="color:#268bd2">Float</span>.<span style="color:#268bd2">NEGATIVE_INFINITY</span>;
        <span style="color:#268bd2">minY</span>=<span style="color:#268bd2">Float</span>.<span style="color:#268bd2">POSITIVE_INFINITY</span>;
        <span style="color:#268bd2">maxY</span>=<span style="color:#268bd2">Float</span>.<span style="color:#268bd2">NEGATIVE_INFINITY</span>;
        <span style="color:#268bd2">minZ</span>=<span style="color:#268bd2">Float</span>.<span style="color:#268bd2">POSITIVE_INFINITY</span>;
        <span style="color:#268bd2">maxZ</span>=<span style="color:#268bd2">Float</span>.<span style="color:#268bd2">NEGATIVE_INFINITY</span>;
    }
    <span style="color:#93a1a1;font-style:italic">//获取包围盒的实际最小以及最大顶点坐标
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">void</span> <span style="color:#268bd2">findMinAndMax</span>(<span style="color:#859900;font-weight:bold">float</span>[] <span style="color:#268bd2">vertices</span>)
    {
        <span style="color:#859900">for</span>(<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">i</span>=<span style="color:#268bd2">0</span>;<span style="color:#268bd2">i</span>&lt;<span style="color:#268bd2">vertices</span>.<span style="color:#268bd2">length</span>/<span style="color:#268bd2">3</span>;<span style="color:#268bd2">i</span>++)
        {
            <span style="color:#93a1a1;font-style:italic">//判断X轴的最小和最大位置
</span><span style="color:#93a1a1;font-style:italic"></span>            <span style="color:#859900">if</span>(<span style="color:#268bd2">vertices</span>[<span style="color:#268bd2">i</span>*<span style="color:#268bd2">3</span>]&lt;<span style="color:#268bd2">minX</span>)
            {
                <span style="color:#268bd2">minX</span>=<span style="color:#268bd2">vertices</span>[<span style="color:#268bd2">i</span>*<span style="color:#268bd2">3</span>];
            }
            <span style="color:#859900">if</span>(<span style="color:#268bd2">vertices</span>[<span style="color:#268bd2">i</span>*<span style="color:#268bd2">3</span>]&gt;<span style="color:#268bd2">maxX</span>)
            {
                <span style="color:#268bd2">maxX</span>=<span style="color:#268bd2">vertices</span>[<span style="color:#268bd2">i</span>*<span style="color:#268bd2">3</span>];
            }
            <span style="color:#93a1a1;font-style:italic">//判断Y轴的最小和最大位置
</span><span style="color:#93a1a1;font-style:italic"></span>            <span style="color:#859900">if</span>(<span style="color:#268bd2">vertices</span>[<span style="color:#268bd2">i</span>*<span style="color:#268bd2">3</span>+<span style="color:#268bd2">1</span>]&lt;<span style="color:#268bd2">minY</span>)
            {
                <span style="color:#268bd2">minY</span>=<span style="color:#268bd2">vertices</span>[<span style="color:#268bd2">i</span>*<span style="color:#268bd2">3</span>+<span style="color:#268bd2">1</span>];
            }
            <span style="color:#859900">if</span>(<span style="color:#268bd2">vertices</span>[<span style="color:#268bd2">i</span>*<span style="color:#268bd2">3</span>+<span style="color:#268bd2">1</span>]&gt;<span style="color:#268bd2">maxY</span>)
            {
                <span style="color:#268bd2">maxY</span>=<span style="color:#268bd2">vertices</span>[<span style="color:#268bd2">i</span>*<span style="color:#268bd2">3</span>+<span style="color:#268bd2">1</span>];
            }
            <span style="color:#93a1a1;font-style:italic">//判断Z轴的最小和最大位置
</span><span style="color:#93a1a1;font-style:italic"></span>            <span style="color:#859900">if</span>(<span style="color:#268bd2">vertices</span>[<span style="color:#268bd2">i</span>*<span style="color:#268bd2">3</span>+<span style="color:#268bd2">2</span>]&lt;<span style="color:#268bd2">minZ</span>)
            {
                <span style="color:#268bd2">minZ</span>=<span style="color:#268bd2">vertices</span>[<span style="color:#268bd2">i</span>*<span style="color:#268bd2">3</span>+<span style="color:#268bd2">2</span>];
            }
            <span style="color:#859900">if</span>(<span style="color:#268bd2">vertices</span>[<span style="color:#268bd2">i</span>*<span style="color:#268bd2">3</span>+<span style="color:#268bd2">2</span>]&gt;<span style="color:#268bd2">maxZ</span>)
            {
                <span style="color:#268bd2">maxZ</span>=<span style="color:#268bd2">vertices</span>[<span style="color:#268bd2">i</span>*<span style="color:#268bd2">3</span>+<span style="color:#268bd2">2</span>];
            }
        }
    }
    <span style="color:#93a1a1;font-style:italic">//获得物体平移后的AABB包围盒
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900">public</span> <span style="color:#268bd2">AABBBox</span> <span style="color:#268bd2">getCurrAABBBox</span>(<span style="color:#268bd2">Vector3f</span> <span style="color:#268bd2">currPosition</span>)
    {
        <span style="color:#268bd2">AABBBox</span> <span style="color:#268bd2">result</span>=<span style="color:#859900">new</span> <span style="color:#268bd2">AABBBox</span>
                (
                        <span style="color:#859900">this</span>.<span style="color:#268bd2">minX</span>+<span style="color:#268bd2">currPosition</span>.<span style="color:#268bd2">x</span>,
                        <span style="color:#859900">this</span>.<span style="color:#268bd2">maxX</span>+<span style="color:#268bd2">currPosition</span>.<span style="color:#268bd2">x</span>,
                        <span style="color:#859900">this</span>.<span style="color:#268bd2">minY</span>+<span style="color:#268bd2">currPosition</span>.<span style="color:#268bd2">y</span>,
                        <span style="color:#859900">this</span>.<span style="color:#268bd2">maxY</span>+<span style="color:#268bd2">currPosition</span>.<span style="color:#268bd2">y</span>,
                        <span style="color:#859900">this</span>.<span style="color:#268bd2">minZ</span>+<span style="color:#268bd2">currPosition</span>.<span style="color:#268bd2">z</span>,
                        <span style="color:#859900">this</span>.<span style="color:#268bd2">maxZ</span>+<span style="color:#268bd2">currPosition</span>.<span style="color:#268bd2">z</span>
                );
        <span style="color:#859900">return</span> <span style="color:#268bd2">result</span>;
    }
}
</code></pre></div><p>在 AABBBox 的构造函数中需要传入物体的顶点序列，在这些序列中分别找出 x 、y、z 坐标的最小值和最大值，也可以直接传入包围盒的 6 个顶点参数。</p>
<p>如果在程序运行过程中，物体发生了移动，那就需要根据移动后的位置计算产生新包围盒对象，<code>getCurrAABBBox</code>方法需要传递物体移动后位置的 3 个坐标分量，用于与原始包围盒的 6 个 参数进行运算，产生移动后包围盒的 6 个参数。</p>
<h2 id="aabb-包围盒的碰撞检测">AABB 包围盒的碰撞检测</h2>
<p>在上面求得了物体的包围盒，求包围盒的目的就是为了简化物体运动过程中的碰撞检测，接下来就是介绍 AABB 包围盒碰撞检测的策略，原理如下图所示：</p>
<p><img src="https://image.glumes.com/images/2019/04/27/bc32fd77gy1ftn2ce177mj20ie04p0tu.jpg" alt=""></p>
<p>由于任何一个 AABB 包围盒的各个面都平行于坐标平面，因此判断两个 AABB 包围盒是否发生碰撞仅需要分别判断 3 个轴方向的交叠部分大小是否大于设定的阈值，若大于则发生了碰撞，否则没有发生碰撞。</p>
<p>具体碰撞检测代码如下：</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">boolean</span> <span style="color:#268bd2">check</span>(<span style="color:#268bd2">RigidBody</span> <span style="color:#268bd2">ra</span>, <span style="color:#268bd2">RigidBody</span> <span style="color:#268bd2">rb</span>)<span style="color:#93a1a1;font-style:italic">//true为撞上
</span><span style="color:#93a1a1;font-style:italic"></span>    {
        <span style="color:#859900;font-weight:bold">float</span>[] <span style="color:#268bd2">over</span> = <span style="color:#268bd2">calOverTotal</span>
                (
	                <span style="color:#93a1a1;font-style:italic">// 两个物体的 AABB 包围盒
</span><span style="color:#93a1a1;font-style:italic"></span>                        <span style="color:#268bd2">ra</span>.<span style="color:#268bd2">collObject</span>.<span style="color:#268bd2">getCurrAABBBox</span>(<span style="color:#268bd2">ra</span>.<span style="color:#268bd2">currLocation</span>),
                        <span style="color:#268bd2">rb</span>.<span style="color:#268bd2">collObject</span>.<span style="color:#268bd2">getCurrAABBBox</span>(<span style="color:#268bd2">rb</span>.<span style="color:#268bd2">currLocation</span>)
                );
        <span style="color:#93a1a1;font-style:italic">// 三个方向的交叠值与设定的阈值进行比较
</span><span style="color:#93a1a1;font-style:italic"></span>        <span style="color:#859900">return</span> <span style="color:#268bd2">over</span>[<span style="color:#268bd2">0</span>] &gt; <span style="color:#268bd2">V_UNIT</span> &amp;&amp; <span style="color:#268bd2">over</span>[<span style="color:#268bd2">1</span>] &gt; <span style="color:#268bd2">V_UNIT</span> &amp;&amp; <span style="color:#268bd2">over</span>[<span style="color:#268bd2">2</span>] &gt; <span style="color:#268bd2">V_UNIT</span>;
    }
	
	<span style="color:#93a1a1;font-style:italic">// 传入两个物体的 AABB 包围盒
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">float</span>[] <span style="color:#268bd2">calOverTotal</span>(<span style="color:#268bd2">AABBBox</span> <span style="color:#268bd2">a</span>, <span style="color:#268bd2">AABBBox</span> <span style="color:#268bd2">b</span>) {
        <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">xOver</span> = <span style="color:#268bd2">calOverOne</span>(<span style="color:#268bd2">a</span>.<span style="color:#268bd2">maxX</span>, <span style="color:#268bd2">a</span>.<span style="color:#268bd2">minX</span>, <span style="color:#268bd2">b</span>.<span style="color:#268bd2">maxX</span>, <span style="color:#268bd2">b</span>.<span style="color:#268bd2">minX</span>);
        <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">yOver</span> = <span style="color:#268bd2">calOverOne</span>(<span style="color:#268bd2">a</span>.<span style="color:#268bd2">maxY</span>, <span style="color:#268bd2">a</span>.<span style="color:#268bd2">minY</span>, <span style="color:#268bd2">b</span>.<span style="color:#268bd2">maxY</span>, <span style="color:#268bd2">b</span>.<span style="color:#268bd2">minY</span>);
        <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">zOver</span> = <span style="color:#268bd2">calOverOne</span>(<span style="color:#268bd2">a</span>.<span style="color:#268bd2">maxZ</span>, <span style="color:#268bd2">a</span>.<span style="color:#268bd2">minZ</span>, <span style="color:#268bd2">b</span>.<span style="color:#268bd2">maxZ</span>, <span style="color:#268bd2">b</span>.<span style="color:#268bd2">minZ</span>);
        <span style="color:#859900">return</span> <span style="color:#859900">new</span> <span style="color:#859900;font-weight:bold">float</span>[]{<span style="color:#268bd2">xOver</span>, <span style="color:#268bd2">yOver</span>, <span style="color:#268bd2">zOver</span>};
    }
	<span style="color:#93a1a1;font-style:italic">// 计算每个轴方向的交叠值
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">calOverOne</span>(<span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">amax</span>, <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">amin</span>, <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">bmax</span>, <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">bmin</span>) {
        <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">minMax</span> = <span style="color:#268bd2">0</span>;
        <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">maxMin</span> = <span style="color:#268bd2">0</span>;
        <span style="color:#859900">if</span> (<span style="color:#268bd2">amax</span> &lt; <span style="color:#268bd2">bmax</span>)<span style="color:#93a1a1;font-style:italic">//a物体在b物体左侧
</span><span style="color:#93a1a1;font-style:italic"></span>        {
            <span style="color:#268bd2">minMax</span> = <span style="color:#268bd2">amax</span>;
            <span style="color:#268bd2">maxMin</span> = <span style="color:#268bd2">bmin</span>;
        } <span style="color:#859900">else</span> <span style="color:#93a1a1;font-style:italic">//a物体在b物体右侧
</span><span style="color:#93a1a1;font-style:italic"></span>        {
            <span style="color:#268bd2">minMax</span> = <span style="color:#268bd2">bmax</span>;
            <span style="color:#268bd2">maxMin</span> = <span style="color:#268bd2">amin</span>;
        }

        <span style="color:#859900">if</span> (<span style="color:#268bd2">minMax</span> &gt; <span style="color:#268bd2">maxMin</span>) {
            <span style="color:#859900">return</span> <span style="color:#268bd2">minMax</span> - <span style="color:#268bd2">maxMin</span>;
        } <span style="color:#859900">else</span> {
            <span style="color:#859900">return</span> <span style="color:#268bd2">0</span>;
        }
    }
</code></pre></div><p>在 calOverTotal 方法里面要传入两个物体的 AABB 包围盒。</p>
<p>然后在 calOverOne 方法里面分别计算两个包围盒 3 个轴的交叠值，思路就是先比较两个AABB 包围盒在对应轴的最大分量，此比较是为了得出两个物体的方位，哪个物体在此轴的正方向那一侧。然后用在轴正方向的那一侧物体的坐标最小值减去在轴负方向那一侧的物体的最大值，如果为负数，则说明没有发生交叠，如果其值为正数，则说明两个物体发生了交叠，交叠值和设定的阈值进行比较。</p>
<h2 id="实践">实践</h2>
<p>具体的实践效果如下：</p>
<p><img src="https://res.cloudinary.com/glumes-com/image/upload/v1532576353/code/collision_demo.gif" alt="碰撞检测示例"></p>
<p>在效果图中，有个两个静止不同的物体，一个来回运动碰撞的物体。</p>
<p>在开发上述效果中，会定义一个 RigidBody 刚体类，它由两个重要的成员，就是我们的绘制物体和它的 AABB 包围盒，如下图所示：</p>
<p><img src="https://image.glumes.com/images/2019/04/27/bc32fd77gy1ftn452gxq7j20fa03rjs2.jpg" alt=""></p>
<p>渲染者指的就是用来渲染的物体，碰撞者指的就是物体的 AABB 包围盒，它们共同组成了刚体 RigidBody 。</p>
<p>RigidBody 代码如下：</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#859900">public</span> <span style="color:#859900">class</span> <span style="color:#cb4b16">RigidBody</span> {
    <span style="color:#268bd2">CollisionObject</span> <span style="color:#268bd2">renderObject</span>;<span style="color:#93a1a1;font-style:italic">//渲染者
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#268bd2">AABBBox</span> <span style="color:#268bd2">collObject</span>;<span style="color:#93a1a1;font-style:italic">//碰撞者
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900;font-weight:bold">boolean</span> <span style="color:#268bd2">isStatic</span>;<span style="color:#93a1a1;font-style:italic">//是否静止的标志位
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#268bd2">Vector3f</span> <span style="color:#268bd2">currLocation</span>;<span style="color:#93a1a1;font-style:italic">//位置三维变量
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#268bd2">Vector3f</span> <span style="color:#268bd2">currV</span>;<span style="color:#93a1a1;font-style:italic">//速度三维变量
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900">final</span> <span style="color:#859900;font-weight:bold">float</span> <span style="color:#268bd2">V_UNIT</span> = <span style="color:#268bd2">0</span>.<span style="color:#268bd2">02f</span>;<span style="color:#93a1a1;font-style:italic">//阈值
</span><span style="color:#93a1a1;font-style:italic"></span>
    <span style="color:#859900">public</span> <span style="color:#268bd2">RigidBody</span>(<span style="color:#268bd2">CollisionObject</span> <span style="color:#268bd2">renderObject</span>, <span style="color:#859900;font-weight:bold">boolean</span> <span style="color:#268bd2">isStatic</span>, <span style="color:#268bd2">Vector3f</span> <span style="color:#268bd2">currLocation</span>, <span style="color:#268bd2">Vector3f</span> <span style="color:#268bd2">currV</span>) {
        <span style="color:#859900">this</span>.<span style="color:#268bd2">renderObject</span> = <span style="color:#268bd2">renderObject</span>;
        <span style="color:#268bd2">collObject</span> = <span style="color:#859900">new</span> <span style="color:#268bd2">AABBBox</span>(<span style="color:#268bd2">renderObject</span>.<span style="color:#268bd2">vertices</span>);
        <span style="color:#859900">this</span>.<span style="color:#268bd2">isStatic</span> = <span style="color:#268bd2">isStatic</span>;
        <span style="color:#859900">this</span>.<span style="color:#268bd2">currLocation</span> = <span style="color:#268bd2">currLocation</span>;
        <span style="color:#859900">this</span>.<span style="color:#268bd2">currV</span> = <span style="color:#268bd2">currV</span>;
    }

    <span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">void</span> <span style="color:#268bd2">drawSelf</span>() {
        <span style="color:#268bd2">MatrixState</span>.<span style="color:#268bd2">pushMatrix</span>();<span style="color:#93a1a1;font-style:italic">//保护现场
</span><span style="color:#93a1a1;font-style:italic"></span>        <span style="color:#268bd2">MatrixState</span>.<span style="color:#268bd2">translate</span>(<span style="color:#268bd2">currLocation</span>.<span style="color:#268bd2">x</span>, <span style="color:#268bd2">currLocation</span>.<span style="color:#268bd2">y</span>, <span style="color:#268bd2">currLocation</span>.<span style="color:#268bd2">z</span>);
        <span style="color:#268bd2">renderObject</span>.<span style="color:#268bd2">drawSelf</span>();<span style="color:#93a1a1;font-style:italic">//绘制物体
</span><span style="color:#93a1a1;font-style:italic"></span>        <span style="color:#268bd2">MatrixState</span>.<span style="color:#268bd2">popMatrix</span>();<span style="color:#93a1a1;font-style:italic">//恢复现场
</span><span style="color:#93a1a1;font-style:italic"></span>    }

    <span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">void</span> <span style="color:#268bd2">go</span>(<span style="color:#268bd2">ArrayList</span>&lt;<span style="color:#268bd2">RigidBody</span>&gt; <span style="color:#268bd2">al</span>) {
        <span style="color:#859900">if</span> (<span style="color:#268bd2">isStatic</span>) <span style="color:#859900">return</span>;
        <span style="color:#268bd2">currLocation</span>.<span style="color:#268bd2">add</span>(<span style="color:#268bd2">currV</span>);
        <span style="color:#859900">for</span> (<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">i</span> = <span style="color:#268bd2">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">al</span>.<span style="color:#268bd2">size</span>(); <span style="color:#268bd2">i</span>++) {

            <span style="color:#268bd2">RigidBody</span> <span style="color:#268bd2">rb</span> = <span style="color:#268bd2">al</span>.<span style="color:#268bd2">get</span>(<span style="color:#268bd2">i</span>);
            <span style="color:#859900">if</span> (<span style="color:#268bd2">rb</span> != <span style="color:#859900">this</span>) {
                <span style="color:#859900">if</span> (<span style="color:#268bd2">check</span>(<span style="color:#859900">this</span>, <span style="color:#268bd2">rb</span>))<span style="color:#93a1a1;font-style:italic">//检验碰撞
</span><span style="color:#93a1a1;font-style:italic"></span>                {
                    <span style="color:#859900">this</span>.<span style="color:#268bd2">currV</span>.<span style="color:#268bd2">x</span> = -<span style="color:#859900">this</span>.<span style="color:#268bd2">currV</span>.<span style="color:#268bd2">x</span>;<span style="color:#93a1a1;font-style:italic">//哪个方向的有速度，该方向上的速度置反
</span><span style="color:#93a1a1;font-style:italic"></span>                }
            }
        }
    }
<span style="color:#93a1a1;font-style:italic">// 省略碰撞检测的代码，在上面已经有了。
</span><span style="color:#93a1a1;font-style:italic"></span>}
</code></pre></div><p>在 RigidBody 的构造函数中，需要传入用来渲染的物体对象，以及是否是静止的标志位，还有表示该物体的位置和移动的向量，向量类型都是之前提到的 <code>Vector3f</code>。</p>
<p>当传入要绘制的对象时，会根据它的顶点计算对应的包围盒，当物体移动后，也会根据新的坐标位置重新计算包围盒。</p>
<p>物体发生移动时，只需要将物体的位置向量加上物体的速度向量，然后调用 <code>Matrix.translateM</code> 方法就可以改变物体位置了。</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#268bd2">Vector3f</span> <span style="color:#268bd2">currLocation</span>;<span style="color:#93a1a1;font-style:italic">//位置三维变量
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#268bd2">Vector3f</span> <span style="color:#268bd2">currV</span>;<span style="color:#93a1a1;font-style:italic">//速度三维变量
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#93a1a1;font-style:italic">// 位置向量加上速度向量，就改变了物体的位置
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#268bd2">currLocation</span>.<span style="color:#268bd2">add</span>(<span style="color:#268bd2">currV</span>);
    <span style="color:#93a1a1;font-style:italic">// translate 方法让改变生效
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#268bd2">MatrixState</span>.<span style="color:#268bd2">translate</span>(<span style="color:#268bd2">currLocation</span>.<span style="color:#268bd2">x</span>, <span style="color:#268bd2">currLocation</span>.<span style="color:#268bd2">y</span>, <span style="color:#268bd2">currLocation</span>.<span style="color:#268bd2">z</span>);
</code></pre></div><p>如果碰撞发生了，并且物体要反向移动，那么就改变速度向量的方向就好了。</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">                <span style="color:#859900">if</span> (<span style="color:#268bd2">check</span>(<span style="color:#859900">this</span>, <span style="color:#268bd2">rb</span>))<span style="color:#93a1a1;font-style:italic">//检验碰撞，如果发生碰撞了，改变方向
</span><span style="color:#93a1a1;font-style:italic"></span>                {
                    <span style="color:#859900">this</span>.<span style="color:#268bd2">currV</span>.<span style="color:#268bd2">x</span> = -<span style="color:#859900">this</span>.<span style="color:#268bd2">currV</span>.<span style="color:#268bd2">x</span>;<span style="color:#93a1a1;font-style:italic">//哪个方向的有速度，该方向上的速度置反
</span><span style="color:#93a1a1;font-style:italic"></span>                }
</code></pre></div><p>具体绘制时，在 GLSurfaceView.Renderer 方法里面就采用刚体 RigidBody 类来绘制就好了。</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#268bd2">var</span> <span style="color:#268bd2">aList</span> = <span style="color:#268bd2">ArrayList</span>&lt;<span style="color:#268bd2">RigidBody</span>&gt;() <span style="color:#93a1a1;font-style:italic">// 定义刚体集合
</span><span style="color:#93a1a1;font-style:italic"></span>	    <span style="color:#93a1a1;font-style:italic">// onSurfaceCreated 方法里面添加要绘制的物体，
</span><span style="color:#93a1a1;font-style:italic"></span>        <span style="color:#268bd2">override</span> <span style="color:#268bd2">fun</span> <span style="color:#268bd2">onSurfaceCreated</span>(<span style="color:#268bd2">gl</span>: <span style="color:#268bd2">GL10</span>?, <span style="color:#268bd2">config</span>: <span style="color:#268bd2">EGLConfig</span>?) {
            <span style="color:#268bd2">aList</span>.<span style="color:#268bd2">add</span>(<span style="color:#268bd2">RigidBody</span>(<span style="color:#268bd2">ch</span>, <span style="color:#859900;font-weight:bold">true</span>, <span style="color:#268bd2">Vector3f</span>(-<span style="color:#268bd2">13f</span>, <span style="color:#268bd2">0f</span>, <span style="color:#268bd2">0f</span>), <span style="color:#268bd2">Vector3f</span>(<span style="color:#268bd2">0f</span>, <span style="color:#268bd2">0f</span>, <span style="color:#268bd2">0f</span>)))
            <span style="color:#268bd2">aList</span>.<span style="color:#268bd2">add</span>(<span style="color:#268bd2">RigidBody</span>(<span style="color:#268bd2">ch</span>, <span style="color:#859900;font-weight:bold">true</span>, <span style="color:#268bd2">Vector3f</span>(<span style="color:#268bd2">13f</span>, <span style="color:#268bd2">0f</span>, <span style="color:#268bd2">0f</span>), <span style="color:#268bd2">Vector3f</span>(<span style="color:#268bd2">0f</span>, <span style="color:#268bd2">0f</span>, <span style="color:#268bd2">0f</span>)))
            <span style="color:#268bd2">aList</span>.<span style="color:#268bd2">add</span>(<span style="color:#268bd2">RigidBody</span>(<span style="color:#268bd2">ch</span>, <span style="color:#859900;font-weight:bold">false</span>, <span style="color:#268bd2">Vector3f</span>(<span style="color:#268bd2">0f</span>, <span style="color:#268bd2">0f</span>, <span style="color:#268bd2">0f</span>), <span style="color:#268bd2">Vector3f</span>(<span style="color:#268bd2">0</span>.<span style="color:#268bd2">1f</span>, <span style="color:#268bd2">0f</span>, <span style="color:#268bd2">0f</span>)))
			<span style="color:#93a1a1;font-style:italic">// 开启一个线程来改变刚体的移动
</span><span style="color:#93a1a1;font-style:italic"></span>            <span style="color:#268bd2">lgt</span> = <span style="color:#268bd2">LovoGoThread</span>(<span style="color:#268bd2">aList</span>)
            <span style="color:#268bd2">lgt</span>.<span style="color:#268bd2">start</span>()
        }
        <span style="color:#93a1a1;font-style:italic">// 绘制刚体
</span><span style="color:#93a1a1;font-style:italic"></span>        <span style="color:#268bd2">override</span> <span style="color:#268bd2">fun</span> <span style="color:#268bd2">onDrawFrame</span>(<span style="color:#268bd2">gl</span>: <span style="color:#268bd2">GL10</span>?) {
            <span style="color:#268bd2">GLES30</span>.<span style="color:#268bd2">glClear</span>(<span style="color:#268bd2">GLES30</span>.<span style="color:#268bd2">GL_DEPTH_BUFFER_BIT</span> <span style="color:#268bd2">or</span> <span style="color:#268bd2">GLES30</span>.<span style="color:#268bd2">GL_COLOR_BUFFER_BIT</span>)
            <span style="color:#859900">for</span> (<span style="color:#268bd2">it</span> <span style="color:#268bd2">in</span> <span style="color:#268bd2">0</span> <span style="color:#268bd2">until</span> <span style="color:#268bd2">aList</span>.<span style="color:#268bd2">size</span>) {
                <span style="color:#268bd2">aList</span>[<span style="color:#268bd2">it</span>].<span style="color:#268bd2">drawSelf</span>()
            }
            <span style="color:#268bd2">pm</span>.<span style="color:#268bd2">drawSelf</span>()
        }
</code></pre></div><p>在物体移动时，开启了一个线程去改变物体的坐标。</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#859900">public</span> <span style="color:#859900">class</span> <span style="color:#cb4b16">LovoGoThread</span> <span style="color:#859900">extends</span> <span style="color:#268bd2">Thread</span> {
    <span style="color:#268bd2">ArrayList</span>&lt;<span style="color:#268bd2">RigidBody</span>&gt; <span style="color:#268bd2">al</span>;<span style="color:#93a1a1;font-style:italic">//控制列表
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900;font-weight:bold">boolean</span> <span style="color:#268bd2">flag</span> = <span style="color:#859900;font-weight:bold">true</span>;<span style="color:#93a1a1;font-style:italic">//线程控制标志位
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900">public</span> <span style="color:#268bd2">LovoGoThread</span>(<span style="color:#268bd2">ArrayList</span>&lt;<span style="color:#268bd2">RigidBody</span>&gt; <span style="color:#268bd2">al</span>) {
        <span style="color:#859900">this</span>.<span style="color:#268bd2">al</span> = <span style="color:#268bd2">al</span>;
    }
    <span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">void</span> <span style="color:#268bd2">run</span>() {
        <span style="color:#859900">while</span> (<span style="color:#268bd2">flag</span>) {
            <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">size</span> = <span style="color:#268bd2">al</span>.<span style="color:#268bd2">size</span>();
            <span style="color:#859900">for</span> (<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">i</span> = <span style="color:#268bd2">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">size</span>; <span style="color:#268bd2">i</span>++) {
                <span style="color:#268bd2">al</span>.<span style="color:#268bd2">get</span>(<span style="color:#268bd2">i</span>).<span style="color:#268bd2">go</span>(<span style="color:#268bd2">al</span>);
            }
            <span style="color:#859900">try</span> {
                <span style="color:#268bd2">sleep</span>(<span style="color:#268bd2">20</span>);
            } <span style="color:#859900">catch</span> (<span style="color:#268bd2">Exception</span> <span style="color:#268bd2">e</span>) {
                <span style="color:#268bd2">e</span>.<span style="color:#268bd2">printStackTrace</span>();
            }
        }
    }
}
</code></pre></div><p>具体的代码，可以参考我的 Github 项目：</p>
<blockquote>
<p><a href="https://github.com/glumes/AndroidOpenGLTutorial">https://github.com/glumes/AndroidOpenGLTutorial</a></p>
</blockquote>
<h2 id="注意点">注意点</h2>
<p>AABB 包围盒的碰撞检测其实还是一种间接检测方案，所以肯定还是会有误差的。</p>
<p>AABB 包围盒对于本身横平竖直的物体在平行于坐标轴摆放的情况下下，计算碰撞检测的误差很小，但对于不规则形状的物体或本身横平竖直的物体在随意倾斜摆放时，计算碰撞检测的误差就会比较大，如下图所示：</p>
<p><img src="https://image.glumes.com/images/2019/04/27/bc32fd77gy1ftn5uds87ej20h604vt96.jpg" alt=""></p>
<p>从图中可以看到，对于同一物体在不同姿态下的 AABB 包围盒以及不同形状的物体的 AABB 包围盒，其物体本身区域占 AABB 包围盒区域的比例是大不相同的。</p>
<p>物体本身区域所占比例越大，则碰撞检测的误差越小，因此在实际开发中应该尽量提高物体本身区域所在的比例，以降低计算误差。</p>
<h2 id="参考">参考</h2>
<ol>
<li>《OpenGL ES 3.x 游戏开发》</li>
</ol>

                  <h2>微信公众号</h2>

<p>扫描下面的二维码关注我的微信公众帐号</p>

<p>添加我的微信 ezglumes 拉你入群一起交流学习~</p>

<img src="https://image.glumes.com/blog_image/wexin-logo.png" alt="wechat-account-qrcode">



        




                <br/>

                

                


        
        
        
      </article>

      
        

<h3>相关文章</h3>
<ul style="margin-bottom: 25px;">
    
    <li><a href="https://glumes.com/post/opengl/opengl-tutorial-light-mix/">《OpenGL ES 3.x 游戏开发》光照系列之效果混合</a></li>
    
    <li><a href="https://glumes.com/post/opengl/opengl-tutorial-specular-light/">《OpenGL ES 3.x 游戏开发》光照系列之镜面光</a></li>
    
    <li><a href="https://glumes.com/post/opengl/opengl-tutorial-diffuse-light/"> 《OpenGL ES 3.x 游戏开发》 光照系列之散射光</a></li>
    
    <li><a href="https://glumes.com/post/opengl/opengl-tutorial-ambient-light/">《OpenGL ES 3.x 游戏开发》光照系列之环境光</a></li>
    
    <li><a href="https://glumes.com/post/opengl/opengl-depth-test/">OpenGL 深度测试与精度值的那些事</a></li>
    
    <li><a href="https://glumes.com/post/opengl/opengl-tutorial-face-culling-usage/">OpenGL 优化项之面剔除和注意点</a></li>
    
    <li><a href="https://glumes.com/post/opengl/opengl-tutorial-vertex-array-object-usage/">《OpenGL ES 3.x 游戏开发》 顶点数组对象 VAO 的使用</a></li>
    
    <li><a href="https://glumes.com/post/opengl/opengl-tutorial-vertex-buffer-object-usage/">《OpenGL ES 3.x 游戏开发》顶点缓冲区 VBO 的使用</a></li>
    
    <li><a href="https://glumes.com/post/opengl/opengl-tutorial-color-blend/">《OpenGL ES 3.x 游戏开发》之颜色混合和使用</a></li>
    
    <li><a href="https://glumes.com/post/opengl/opengl-tutorial-alpha-test/">《OpenGL ES 3.x 游戏开发》之利用 Alpha 透明度进行测试</a></li>
    
</ul>

      

      
      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="https://glumes.com/post/android/android-jni-bitmap-operation/" data-toggle="tooltip" data-placement="top" title="Android JNI 之 Bitmap 操作">&larr; Previous Post</a>
          </li>
        
        
          <li class="next">
            <a href="https://glumes.com/post/android/java-proxy-design-pattern/" data-toggle="tooltip" data-placement="top" title="Java 中的静态代理和动态代理">Next Post &rarr;</a>
          </li>
        
      </ul>
      

      
        
      





    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">

          
          
          
              <li>
                <a href="mailto:zhaoying9402@outlook.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
              <li>
                <a href="https://github.com/glumes" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
              <li>
                <a href="https://weibo.com/u/3157458295" title="微博">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;
          2020

          
            &nbsp;&bull;&nbsp;
            <a href="https://glumes.com/">星陨的博客</a>
            &nbsp;&bull;&nbsp;
            <a href="https://glumes.com/sitemap.xml">网站地图</a>
          
             &nbsp;&bull;&nbsp;
                      <a href="http://beian.miit.gov.cn">粤ICP备20067247号</a>
        </p>






                <p class="text-center text-muted">
          <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
          <span id="busuanzi_container_site_pv" style="display:none">
            本站总访问量<span id="busuanzi_value_site_pv"></span>次
          </span>
          &nbsp;&bull;&nbsp;
          <span id="busuanzi_container_site_uv" style="display:none">
            访客数<span id="busuanzi_value_site_uv"></span>人次
          </span>
          &nbsp;&bull;&nbsp;
                 <span id="busuanzi_container_page_pv" style="display:none">
            阅读量<span id="busuanzi_value_page_pv"></span>人次
          </span>
        </p>

<p>
<a target="_blank"; href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral";>
<img style="height:20px;width:auto;"; src="https://www.upyun.com/static/img/%E6%A0%B7%E5%BC%8F%E5%9B%BE.7cf927c.png"; />
</a>
</P>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.74.3</a> powered &nbsp;&bull;&nbsp; Theme by <a href="https://github.com/rootsongjc/beautifulhugo">Beautiful Hugo</a> adapted to <a href="https://github.com/glumes/glumes.com">glumes-blog</a>
          
        </p>

      </div>
    </div>
  </div>
</footer>


<script src="https://glumes.com/js/jquery-1.11.2.min.js"></script>
<script src="https://glumes.com/js/bootstrap.min.js"></script>
<script src="https://glumes.com/js/main.min.js"></script>
<script src="https://glumes.com/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script src="https://glumes.com/js/prism.js?t=123"></script>





<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>







  





  </body>
</html>

